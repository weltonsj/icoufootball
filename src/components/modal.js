function ensureModalRoot() { let r = document.getElementById('modal-root'); if (!r) { r = document.createElement('div'); r.id = 'modal-root'; document.body.appendChild(r) } return r }
function bindClose(overlay,modal){function close(){overlay.remove()}overlay.addEventListener('click',e=>{if(e.target===overlay)close()});document.addEventListener('keydown',function esc(e){if(e.key==='Escape'){close();document.removeEventListener('keydown',esc)}})}
function showModal(type, title, message) { const root = ensureModalRoot(); const overlay = document.createElement('div'); overlay.className = 'modal-overlay'; const modal = document.createElement('div'); modal.className = `modal modal-${type}`; modal.setAttribute('role','dialog'); modal.setAttribute('aria-modal','true'); const h = document.createElement('h3'); h.textContent = title; const p = document.createElement('p'); p.textContent = message; const btn = document.createElement('button'); btn.className = 'modal-btn'; btn.textContent = 'OK'; btn.onclick = () => { overlay.remove() }; modal.appendChild(h); modal.appendChild(p); modal.appendChild(btn); overlay.appendChild(modal); root.appendChild(overlay); btn.focus(); bindClose(overlay,modal) }
function showConfirmModal(title,message){return new Promise(resolve=>{const root=ensureModalRoot();const overlay=document.createElement('div');overlay.className='modal-overlay';const modal=document.createElement('div');modal.className='modal';modal.setAttribute('role','dialog');modal.setAttribute('aria-modal','true');const h=document.createElement('h3');h.textContent=title;const p=document.createElement('p');p.textContent=message;const actions=document.createElement('div');actions.className='modal-actions';const btnCancel=document.createElement('button');btnCancel.className='modal-btn';btnCancel.textContent='Cancelar';const btnOk=document.createElement('button');btnOk.className='modal-btn';btnOk.textContent='Confirmar';btnCancel.onclick=()=>{overlay.remove();resolve(false)};btnOk.onclick=()=>{overlay.remove();resolve(true)};actions.appendChild(btnCancel);actions.appendChild(btnOk);modal.appendChild(h);modal.appendChild(p);modal.appendChild(actions);overlay.appendChild(modal);root.appendChild(overlay);btnOk.focus();bindClose(overlay,modal)})}
function showEmailPromptModal(title){return new Promise(resolve=>{const root=ensureModalRoot();const overlay=document.createElement('div');overlay.className='modal-overlay';const modal=document.createElement('div');modal.className='modal';modal.setAttribute('role','dialog');modal.setAttribute('aria-modal','true');const h=document.createElement('h3');h.textContent=title;const input=document.createElement('input');input.type='email';input.placeholder='Email';input.setAttribute('aria-invalid','true');input.addEventListener('input',()=>{const ok=/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(input.value);input.setAttribute('aria-invalid',ok?'false':'true')});const actions=document.createElement('div');actions.className='modal-actions';const btnCancel=document.createElement('button');btnCancel.className='modal-btn';btnCancel.textContent='Cancelar';const btnOk=document.createElement('button');btnOk.className='modal-btn';btnOk.textContent='Enviar';btnCancel.onclick=()=>{overlay.remove();resolve(null)};btnOk.onclick=()=>{const ok=/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(input.value);if(!ok)return;overlay.remove();resolve(input.value)};modal.appendChild(h);modal.appendChild(input);modal.appendChild(actions);actions.appendChild(btnCancel);actions.appendChild(btnOk);overlay.appendChild(modal);root.appendChild(overlay);input.focus();bindClose(overlay,modal)})}
function showPasswordResetModal(title){return new Promise(resolve=>{const root=ensureModalRoot();const overlay=document.createElement('div');overlay.className='modal-overlay';const modal=document.createElement('div');modal.className='modal';modal.setAttribute('role','dialog');modal.setAttribute('aria-modal','true');const h=document.createElement('h3');h.textContent=title;const pass=document.createElement('input');pass.type='password';pass.placeholder='Nova senha';pass.setAttribute('aria-invalid','true');const confirm=document.createElement('input');confirm.type='password';confirm.placeholder='Confirmar senha';confirm.setAttribute('aria-invalid','true');function v(){const strong=pass.value.length>=6&&/[A-Za-z]/.test(pass.value)&&/[0-9]/.test(pass.value);pass.setAttribute('aria-invalid',strong?'false':'true');confirm.setAttribute('aria-invalid',confirm.value===pass.value&&strong?'false':'true')}pass.addEventListener('input',v);confirm.addEventListener('input',v);const actions=document.createElement('div');actions.className='modal-actions';const btnCancel=document.createElement('button');btnCancel.className='modal-btn';btnCancel.textContent='Cancelar';const btnOk=document.createElement('button');btnOk.className='modal-btn';btnOk.textContent='Alterar';btnCancel.onclick=()=>{overlay.remove();resolve(null)};btnOk.onclick=()=>{v();const valid=pass.getAttribute('aria-invalid')==='false'&&confirm.getAttribute('aria-invalid')==='false';if(!valid)return;overlay.remove();resolve({password:pass.value})};modal.appendChild(h);modal.appendChild(pass);modal.appendChild(confirm);modal.appendChild(actions);actions.appendChild(btnCancel);actions.appendChild(btnOk);overlay.appendChild(modal);root.appendChild(overlay);pass.focus();bindClose(overlay,modal)})}
export { showModal, showConfirmModal, showEmailPromptModal, showPasswordResetModal }
